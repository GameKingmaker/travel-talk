{# templates/travel/hotel_1.html #}
{% extends "base.html" %}

{% set page_title = "í˜¸í…” ì²´í¬ì¸ | ì¼ë³¸ ì—¬í–‰ ì‹œë®¬ë ˆì´ì…˜" %}
{% set page_desc = "í˜¸í…” í”„ë¡ íŠ¸ì—ì„œ ì²´í¬ì¸í•˜ëŠ” ì¼ë³¸ì–´ íšŒí™” ìƒí™©" %}
{% set page_robots = "noindex,nofollow" %}

{% block content %}
<style>
  .travel-wrap{ max-width:1080px; margin:0 auto; padding:22px 18px 48px; }
  .stage{
    position:relative; width:100%; aspect-ratio:16/9;
    border-radius:18px; overflow:hidden;
    box-shadow:0 18px 40px rgba(2,8,23,.20);
    background:#0b1220;
  }
  .bg{
    position:absolute; inset:0;
    background:url('{{ url_for("static", filename="travel/bg/hotel.png") }}') center/cover no-repeat;
  }
  .char{
    position:absolute; left:50%; bottom:14%;
    transform:translateX(-50%);
    width:clamp(340px,46%,520px);
    max-height:84%;
    object-fit:contain;
    pointer-events:none;
    filter:drop-shadow(0 18px 30px rgba(0,0,0,.35));
  }
  .hud{ position:absolute; left:16px; top:14px; display:flex; gap:10px; z-index:5; }
  .chip{
    background:rgba(255,255,255,.9);
    border:1px solid rgba(226,232,240,.9);
    border-radius:999px;
    padding:8px 12px;
    font-weight:900; font-size:13px; color:#0f172a;
  }
  .box{
    position:absolute; left:0; right:0; bottom:0;
    padding:16px 18px 18px;
    background:rgba(54,17,92,.88);
    backdrop-filter:blur(6px);
    min-height:170px; z-index:6;
  }
  .name{ font-weight:900; color:#fff; margin-bottom:8px; }
  .line{ color:#fff; font-size:16px; line-height:1.55; white-space:pre-line; }
  .right-hint{ position:absolute; right:18px; top:16px; color:rgba(255,255,255,.75); font-size:12px; font-weight:800; }
  .choices{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
  .choice-btn{
    background:rgba(255,255,255,.1);
    border:1px solid rgba(255,255,255,.22);
    color:#fff; padding:10px 12px;
    border-radius:12px; font-weight:900;
    cursor:pointer;
  }
  .controls{ position:absolute; right:16px; bottom:16px; display:flex; gap:10px; }
  .navbtn{
    background:rgba(255,255,255,.14);
    border:1px solid rgba(255,255,255,.22);
    color:#fff; padding:10px 14px;
    border-radius:12px; font-weight:900;
  }
  .navbtn:disabled{ opacity:.45; cursor:not-allowed; }
  .worldmap-btn{
  position:absolute;
  top:14px;
  right:16px;
  z-index:20;
}

.worldmap-btn button{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 14px;
  border-radius:999px;
  background: rgba(255,255,255,.92);
  border:1px solid rgba(226,232,240,.95);
  box-shadow: 0 10px 18px rgba(2,8,23,.12);
  font-size:13px;
  font-weight:1000;
  color:#0f172a;
  cursor:pointer;
  transition: transform .1s ease, box-shadow .12s ease;
}

.worldmap-btn button:hover{
  transform: translateY(-1px);
  box-shadow: 0 14px 24px rgba(2,8,23,.18);
}

</style>

<div class="travel-wrap">
  <div class="stage" id="stage">
    <div class="bg"></div>
<!-- âœ… ì›”ë“œë§µ ë³µê·€ ë²„íŠ¼ -->
<div class="worldmap-btn">
  <button onclick="goWorldMap()">ğŸ—ºï¸ ì›”ë“œë§µìœ¼ë¡œ</button>
</div>

    <div class="hud">
      <div class="chip">í˜¸í…”</div>
      <div class="chip" id="count">1 / 1</div>
    </div>

    <img class="char"
         src="{{ url_for('static', filename='travel/char/hotel_staff.png') }}"
         alt="hotel_staff">

    <div class="box">
      <div class="right-hint">í´ë¦­ ë˜ëŠ” ë‹¤ìŒ ë²„íŠ¼ìœ¼ë¡œ ì§„í–‰</div>
      <p class="name" id="speaker"></p>
      <p class="line" id="line"></p>

      <div class="choices" id="choices" style="display:none"></div>

      <div class="controls">
        <button class="navbtn" id="prevBtn">ì´ì „</button>
        <button class="navbtn" id="nextBtn">ë‹¤ìŒ</button>
      </div>
    </div>
  </div>
</div>

<script>
function fmt(jp,kana,ko){ return `${jp}\n${kana}\n(${ko})`; }

const SCRIPT = [
  { type:"line", speaker:"ë‚´ë ˆì´ì…˜",
    jp:"ãƒ›ãƒ†ãƒ«ã«åˆ°ç€ã—ã¾ã—ãŸã€‚",
    kana:"í˜¸í…Œë£¨ë‹ˆ í† -ì°¨ì¿  ì‹œë§ˆì‹œíƒ€.",
    ko:"í˜¸í…”ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤."
  },
  { type:"line", speaker:"ì§ì›",
    jp:"ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ã€‚ã”ç”¨ä»¶ã‚’ãŠä¼ºã„ã—ã¾ã™ã€‚",
    kana:"ì´ë¼ìƒ¤ì´ë§ˆì„¸. ê³ ìš”-ì¼„ì˜¤ ì˜¤ìš°ì¹´ê°€ì´ ì‹œë§ˆìŠ¤.",
    ko:"ì–´ì„œ ì˜¤ì„¸ìš”. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?"
  },

  // âœ… ë¬¸ì œ: ì²´í¬ì¸ ìš”ì²­
  { type:"choice", speaker:"ë‚˜",
    question_ko:"(ë¬¸ì œ) ì²´í¬ì¸ì„ ìš”ì²­í•˜ë ¤ë©´?",
    choices:[
      { jp:"ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚",
        kana:"ì²´í¬ì¸ì˜¤ ì˜¤ë„¤ê°€ì´ ì‹œë§ˆìŠ¤.",
        ko:"ì²´í¬ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤.",
        correct:true
      },
      { jp:"ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚",
        kana:"ì²´í¬ì•„ì›ƒì˜¤ ì˜¤ë„¤ê°€ì´ ì‹œë§ˆìŠ¤.",
        ko:"ì²´í¬ì•„ì›ƒ ë¶€íƒë“œë¦½ë‹ˆë‹¤.",
        correct:false
      },
      { jp:"éƒ¨å±‹ã‚’é£Ÿã¹ã¾ã™ã€‚",
        kana:"í—¤ì•¼ì˜¤ íƒ€ë² ë§ˆìŠ¤.",
        ko:"ë°©ì„ ë¨¹ìŠµë‹ˆë‹¤.",
        correct:false
      }
    ]
  },

  { type:"line", speaker:"ì§ì›",
    jp:"ã‹ã—ã“ã¾ã‚Šã¾ã—ãŸã€‚ã“ã¡ã‚‰ã«ã”è¨˜å…¥ãã ã•ã„ã€‚",
    kana:"ì¹´ì‹œì½”ë§ˆë¦¬ë§ˆì‹œíƒ€. ì½”ì¹˜ë¼ë‹ˆ ê³ í‚¤ë‰´- ì¿ ë‹¤ì‚¬ì´.",
    ko:"ì•Œê² ìŠµë‹ˆë‹¤. ì´ìª½ì— ê¸°ì…í•´ì£¼ì„¸ìš”."
  },
  { type:"line", speaker:"ë‚´ë ˆì´ì…˜",
    jp:"ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãŒç„¡äº‹ã«å®Œäº†ã—ã¾ã—ãŸã€‚",
    kana:"ì²´í¬ì¸ì´ê°€ ë¶€ì§€ë‹ˆ ì¹¸ë£Œ- ì‹œë§ˆì‹œíƒ€.",
    ko:"ì²´í¬ì¸ì´ ë¬´ì‚¬íˆ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
  },

  // âœ… ì—”ë”©
  { type:"line", speaker:"ë‚´ë ˆì´ì…˜",
    jp:"éƒ¨å±‹ã«å‘ã‹ã£ã¦ä¼‘ã¿ã¾ã—ã‚‡ã†ã€‚",
    kana:"í—¤ì•¼ë‹ˆ ë¬´ìº‡í…Œ ì•¼ìŠ¤ë¯¸ë§ˆì‡¼-.",
    ko:"ë°©ìœ¼ë¡œ ê°€ì„œ ì‰¬ë„ë¡ í•˜ì£ ."
  },
  { type:"line", speaker:"ë‚´ë ˆì´ì…˜",
    jp:"ä»Šæ—¥ã¯ã©ã‚“ãªä¸€æ—¥ã§ã—ãŸã‹ï¼Ÿæ¬¡ã¯ã©ã“ã¸è¡Œãã¾ã—ã‚‡ã†ã‹ï¼Ÿ",
    kana:"ì¿„-ì™€ ëˆë‚˜ ì´ì¹˜ë‹ˆì¹˜ ë°ì‹œíƒ€ì¹´? ì¸ ê¸°ì™€ ë„ì½”ì— ì´í‚¤ë§ˆì‡¼-ì¹´?",
    ko:"ì˜¤ëŠ˜ í•˜ë£¨ë„ ì•Œì°¼ë‹¤. ë‹¤ìŒì€ ì–´ë””ë¡œ ê°€ë³¼ê¹Œ?",
    goto:"/travel/worldmap?current=hotel"
  }
];

let idx=0, locked=false;
const sp=document.getElementById("speaker");
const ln=document.getElementById("line");
const ch=document.getElementById("choices");
const prev=document.getElementById("prevBtn");
const next=document.getElementById("nextBtn");
const cnt=document.getElementById("count");
const stage=document.getElementById("stage");

function render(){
  cnt.textContent=`${Math.min(idx+1,SCRIPT.length)} / ${SCRIPT.length}`;
  prev.disabled=(idx<=0)||locked;
  const s=SCRIPT[idx];
  ch.style.display="none"; ch.innerHTML="";
  next.disabled=locked;

  if(s.type==="line"){
    sp.textContent=s.speaker;
    ln.textContent=fmt(s.jp,s.kana,s.ko);
    next.disabled=false;
    return;
  }

  if(s.type==="choice"){
    sp.textContent=s.speaker;
    ln.textContent=s.question_ko;
    locked=true; next.disabled=true;
    ch.style.display="flex";
    s.choices.forEach(c=>{
      const b=document.createElement("button");
      b.className="choice-btn";
      b.textContent=`${c.jp} / ${c.kana}`;
      b.onclick=(e)=>{
        e.stopPropagation();
        ln.textContent=fmt(c.jp,c.kana,c.ko);
        if(c.correct){
  // âœ… ì •ë‹µ í´ë¦­ ì§í›„ stage í´ë¦­ìœ¼ë¡œ ë„˜ì–´ê°€ë©° ìŠ¤í‚µë˜ëŠ” ê±¸ ë°©ì§€
  ch.style.display = "none";
  next.disabled = false;

  locked = true;                 // ì ê¹ ì ê¸ˆ ìœ ì§€
  setTimeout(() => { locked = false; }, 0);   // ì´ë²¤íŠ¸ ë£¨í”„ ë‹¤ìŒ í‹±ì—ì„œ í•´ì œ
}else{
  ch.innerHTML="";
  const r=document.createElement("button");
  r.className="choice-btn";
  r.textContent="ë‹¤ì‹œ ì„ íƒ";
  r.onclick=(ev)=>{ ev.stopPropagation(); render(); };
  ch.appendChild(r);
}

      };
      ch.appendChild(b);
    });
  }
}

prev.onclick=()=>{ if(idx>0){ idx--; locked=false; render(); } };
next.onclick=()=>{
  const s=SCRIPT[idx];
  if(s.goto){ location.href=s.goto; return; }
  if(!locked && idx<SCRIPT.length-1){ idx++; render(); }
};
stage.onclick=(e)=>{ 
  e.stopPropagation();
  if(!locked) next.onclick(); 
};


render();
function goWorldMap(){
  // í˜„ì¬ ì”¬ idë¥¼ worldmapì— ì „ë‹¬
  // ì˜ˆ: department, convenience, hospital ë“±
  const CURRENT_PLACE = "{{ current_place|default('hotel') }}";
  window.location.href = `/travel/worldmap?current=${CURRENT_PLACE}`;
}

</script>
{% endblock %}
