{# templates/travel/park_1.html #}
{% extends "base.html" %}

{% set page_title = "ë†€ì´ê³µì› 1í™” | ì¼ë³¸ ì—¬í–‰ ì‹œë®¬ë ˆì´ì…˜" %}
{% set page_desc = "ë†€ì´ê³µì› ë§¤í‘œì†Œì—ì„œ ì§ì›ê³¼ì˜ ëŒ€í™”ë¡œ ì¼ë³¸ì–´ë¥¼ ê²Œì„ì²˜ëŸ¼ í•™ìŠµí•´ë³´ì„¸ìš”." %}
{% set page_robots = "noindex,nofollow" %}

{% block content %}
<style>
  .travel-wrap{ max-width:1080px; margin:0 auto; padding:22px 18px 48px; }
  .stage{
    position:relative;
    width:100%;
    aspect-ratio:16/9;
    border-radius:18px;
    overflow:hidden;
    box-shadow: 0 18px 40px rgba(2,8,23,.20);
    background:#0b1220;
  }
  .bg{
    position:absolute; inset:0;
    background: url("{{ url_for('static', filename='travel/bg/park_ticketbooth.png') }}") center/cover no-repeat;
    filter: saturate(1.02);
  }
  .char{
    position:absolute;
    left: 50%;
    bottom: 15%;
    transform: translateX(-50%);
    width: clamp(340px, 46%, 520px);
    max-height: 84%;
    object-fit: contain;
    pointer-events: none;
    filter: drop-shadow(0 18px 30px rgba(0,0,0,.35));
  }
  .hud{
    position:absolute; left:16px; top:14px;
    display:flex; gap:10px; z-index:5;
  }
  .chip{
    background: rgba(255,255,255,.90);
    border: 1px solid rgba(226,232,240,.9);
    border-radius:999px;
    padding:8px 12px;
    font-weight:900;
    font-size:13px;
    color:#0f172a;
  }
  .box{
    position:absolute; left:0; right:0; bottom:0;
    padding:16px 18px 18px;
    background: rgba(54, 17, 92, .88);
    backdrop-filter: blur(6px);
    z-index:6;
    min-height: 170px;
  }
  .name{
    font-weight:900;
    color:#fff;
    margin:0 0 8px 0;
    font-size:16px;
  }
  .line{
    color:#fff;
    font-size:16px;
    line-height:1.55;
    white-space:pre-line;
    margin:0;
  }
  .right-hint{
    position:absolute; right:18px; top:16px;
    color: rgba(255,255,255,.75);
    font-size:12px;
    font-weight:800;
  }
  .choices{ margin-top:12px; display:flex; flex-wrap:wrap; gap:10px; }
  .choice-btn{
    background: rgba(255,255,255,.10);
    border: 1px solid rgba(255,255,255,.22);
    color:#fff;
    border-radius:12px;
    padding:10px 12px;
    font-weight:900;
    cursor:pointer;
    transition: transform .08s ease, background .12s ease;
  }
  .choice-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.16); }
  .controls{
    position:absolute; right:16px; bottom:16px;
    display:flex; gap:10px;
  }
  .navbtn{
    background: rgba(255,255,255,.14);
    border: 1px solid rgba(255,255,255,.22);
    color:#fff;
    border-radius:12px;
    padding:10px 14px;
    font-weight:900;
    cursor:pointer;
  }
  .navbtn:disabled{ opacity:.45; cursor:not-allowed; }
  @media (max-width: 600px){
    .line{ font-size:14px; }
    .name{ font-size:14px; }
    .choice-btn, .navbtn{ padding:9px 12px; }
  }
  .worldmap-btn{
  position:absolute;
  top:14px;
  right:16px;
  z-index:20;
}

.worldmap-btn button{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 14px;
  border-radius:999px;
  background: rgba(255,255,255,.92);
  border:1px solid rgba(226,232,240,.95);
  box-shadow: 0 10px 18px rgba(2,8,23,.12);
  font-size:13px;
  font-weight:1000;
  color:#0f172a;
  cursor:pointer;
  transition: transform .1s ease, box-shadow .12s ease;
}

.worldmap-btn button:hover{
  transform: translateY(-1px);
  box-shadow: 0 14px 24px rgba(2,8,23,.18);
}

</style>

<div class="travel-wrap">
  <div class="stage" id="stage">
    <div class="bg"></div>
<!-- âœ… ì›”ë“œë§µ ë³µê·€ ë²„íŠ¼ -->
<div class="worldmap-btn">
  <button onclick="goWorldMap()">ğŸ—ºï¸ ì›”ë“œë§µìœ¼ë¡œ</button>
</div>

    <div class="hud">
      <div class="chip">ì¥ë©´</div>
      <div class="chip" id="count">1 / 1</div>
    </div>

    <!-- âœ… ë§¤í‘œì†Œ ë‚¨ì ì§ì› ìºë¦­í„° -->
    <img class="char" src="{{ url_for('static', filename='travel/char/park_ticket_male.png') }}" alt="park_ticket_male">

    <div class="box">
      <div class="right-hint" id="hint">í´ë¦­ ë˜ëŠ” ë‹¤ìŒ ë²„íŠ¼ìœ¼ë¡œ ì§„í–‰</div>
      <p class="name" id="speaker">ì§ì›</p>
      <p class="line" id="line"></p>

      <div class="choices" id="choices" style="display:none;"></div>

      <div class="controls">
        <button class="navbtn" id="prevBtn">ì´ì „</button>
        <button class="navbtn" id="nextBtn">ë‹¤ìŒ</button>
      </div>
    </div>
  </div>
</div>

<script>
  function fmt(jp, kana, ko){
    return `${jp}\n${kana}\n(${ko})`;
  }

  // âœ… ë†€ì´ê³µì› ë§¤í‘œì†Œ ìƒí™© ìŠ¤í¬ë¦½íŠ¸ (ì¤‘ê°„ì— ë¬¸ì œ/ì„ íƒì§€ 1ë²ˆ)
  const SCRIPT = [
    { type:"line", speaker:"ì§ì›", jp:"ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ã€‚ãƒã‚±ãƒƒãƒˆå£²ã‚Šå ´ã§ã™ã€‚", kana:"ì´ë¼ìƒ¤ì´ë§ˆì„¸. ì¹˜ì¼“í†  ìš°ë¦¬ë°” ë°ìŠ¤.", ko:"ì–´ì„œ ì˜¤ì„¸ìš”. ë§¤í‘œì†Œì…ë‹ˆë‹¤." },
    { type:"line", speaker:"ì§ì›", jp:"ä½•åæ§˜ã§ã™ã‹ï¼Ÿ", kana:"ë‚œë©”-ì‚¬ë§ˆ ë°ìŠ¤ì¹´?", ko:"ëª‡ ë¶„ì´ì‹ ê°€ìš”?" },

    // âœ… ë¬¸ì œ(ì„ íƒì§€)
    { type:"choice", speaker:"ë‚˜",
      question_ko:"(ìƒí™©) ë‘ ì¥(2ëª…) í‹°ì¼“ì„ ì‚¬ê³  ì‹¶ë‹¤. ê°€ì¥ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€ë‹µì€?",
      choices:[
        { label:"ë‘ ëª…ì…ë‹ˆë‹¤", jp:"äºŒäººã§ã™ã€‚", kana:"í›„íƒ€ë¦¬ ë°ìŠ¤.", ko:"ë‘ ëª…ì…ë‹ˆë‹¤.", correct:true },
        { label:"ê´€ê´‘ì…ë‹ˆë‹¤", jp:"è¦³å…‰ã§ã™ã€‚", kana:"ì¹¸ì½”-ë°ìŠ¤.", ko:"ê´€ê´‘ì…ë‹ˆë‹¤.", correct:false },
        { label:"ì—¬ê¶Œì„ ë³´ì—¬ì£¼ì„¸ìš”", jp:"ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã‚’è¦‹ã›ã¦ãã ã•ã„ã€‚", kana:"íŒŒìŠ¤í¬-í† ì˜¤ ë¯¸ì„¸í…Œ ì¿ ë‹¤ì‚¬ì´.", ko:"ì—¬ê¶Œì„ ë³´ì—¬ì£¼ì„¸ìš”.", correct:false },
      ]
    },

    { type:"line", speaker:"ì§ì›", jp:"ã‹ã—ã“ã¾ã‚Šã¾ã—ãŸã€‚äºŒæšã§ã™ã­ã€‚", kana:"ì¹´ì‹œì½”ë§ˆë¦¬ë§ˆì‹œíƒ€. ë‹ˆë§ˆì´ ë°ìŠ¤ë„¤.", ko:"ì•Œê² ìŠµë‹ˆë‹¤. 2ì¥ì´êµ°ìš”." },
    { type:"line", speaker:"ì§ì›", jp:"ãŠæ”¯æ‰•ã„ã¯ç¾é‡‘ã§ã™ã‹ã€ã‚«ãƒ¼ãƒ‰ã§ã™ã‹ï¼Ÿ", kana:"ì˜¤ì‹œí•˜ë¼ì´ì™€ ê²í‚¨ ë°ìŠ¤ì¹´, ì¹´-ë„ ë°ìŠ¤ì¹´?", ko:"ê²°ì œëŠ” í˜„ê¸ˆì¸ê°€ìš”, ì¹´ë“œì¸ê°€ìš”?" },

    { type:"choice", speaker:"ë‚˜",
      question_ko:"(ìƒí™©) ì¹´ë“œë¡œ ê²°ì œí•˜ê³  ì‹¶ë‹¤. ì–´ë–¤ ë§ì´ ë§ì„ê¹Œ?",
      choices:[
        { label:"ë„ì™€ì£¼ì„¸ìš”", jp:"åŠ©ã‘ã¦ãã ã•ã„ã€‚", kana:"íƒ€ìŠ¤ì¼€í…Œ ì¿ ë‹¤ì‚¬ì´.", ko:"ë„ì™€ì£¼ì„¸ìš”.", correct:false },
        { label:"ì €ëŠ” í•™ìƒì…ë‹ˆë‹¤", jp:"ç§ã¯å­¦ç”Ÿã§ã™ã€‚", kana:"ì™€íƒ€ì‹œì™€ ê°€ì¿ ì„¸- ë°ìŠ¤.", ko:"ì €ëŠ” í•™ìƒì…ë‹ˆë‹¤.", correct:false },
        { label:"ì¹´ë“œë¡œ í• ê²Œìš”", jp:"ã‚«ãƒ¼ãƒ‰ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚", kana:"ì¹´-ë„ë° ì˜¤ë„¤ê°€ì´ì‹œë§ˆìŠ¤.", ko:"ì¹´ë“œë¡œ ë¶€íƒí•©ë‹ˆë‹¤.", correct:true },
      ]
    },

    { type:"line", speaker:"ì§ì›", jp:"ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ã“ã¡ã‚‰ãŒãƒã‚±ãƒƒãƒˆã§ã™ã€‚", kana:"ì•„ë¦¬ê°€í† - ê³ ìì´ë§ˆìŠ¤. ì½”ì¹˜ë¼ê°€ ì¹˜ì¼“í†  ë°ìŠ¤.", ko:"ê°ì‚¬í•©ë‹ˆë‹¤. ì—¬ê¸° í‹°ì¼“ì…ë‹ˆë‹¤." },

    {
    type:"line",
    speaker:"ë‚´ë ˆì´ì…˜",
    jp:"ãƒã‚±ãƒƒãƒˆã‚’æŒã£ã¦ä¸­ã¸å…¥ã‚Šã¾ã—ãŸã€‚",
    kana:"ì¹˜ì¼“í† ì˜¤ ëª»í…Œ ë‚˜ì¹´ì— í•˜ì´ë¦¬ë§ˆì‹œíƒ€.",
    ko:"í‹°ì¼“ì„ ë“¤ê³  ë†€ì´ê³µì› ì•ˆìœ¼ë¡œ ë“¤ì–´ê°”ìŠµë‹ˆë‹¤.",
    goto:"/travel/scene/park_inside_1"
    },

  ];

  let idx = 0;
  let locked = false;

  const elSpeaker = document.getElementById("speaker");
  const elLine = document.getElementById("line");
  const elChoices = document.getElementById("choices");
  const elPrev = document.getElementById("prevBtn");
  const elNext = document.getElementById("nextBtn");
  const elCount = document.getElementById("count");
  const stage = document.getElementById("stage");

  function render(){
    elCount.textContent = `${Math.min(idx+1, SCRIPT.length)} / ${SCRIPT.length}`;
    elPrev.disabled = (idx <= 0) || locked;

    const step = SCRIPT[idx];
    if(!step) return;

    elChoices.style.display = "none";
    elChoices.innerHTML = "";
    elNext.disabled = locked;

    if(step.type === "line"){
      elSpeaker.textContent = step.speaker || "";
      elLine.textContent = fmt(step.jp || "", step.kana || "", step.ko || "");
      elNext.disabled = false;
      return;
    }

    if(step.type === "choice"){
      elSpeaker.textContent = step.speaker || "";
      elLine.textContent = step.question_ko ? step.question_ko : "ì„ íƒì§€ë¥¼ ê³¨ë¼ì£¼ì„¸ìš”.";
      locked = true;
      elNext.disabled = true;

      elChoices.style.display = "flex";
      step.choices.forEach((c)=>{
        const b = document.createElement("button");
        b.className = "choice-btn";
        b.textContent = `${c.jp}  /  ${c.kana}`;
        b.onclick = (e)=>{
          e.stopPropagation();
          elLine.textContent = `${c.jp}\n${c.kana}\n(${c.ko})`;

          if(c.correct){
            locked = false;
            elNext.disabled = false;
            elPrev.disabled = (idx <= 0);
            elChoices.style.display = "none";
          }else{
            elChoices.innerHTML = "";
            const retry = document.createElement("button");
            retry.className = "choice-btn";
            retry.textContent = "ë‹¤ì‹œ ì„ íƒí•˜ê¸°";
            retry.onclick = (ev)=>{
              ev.stopPropagation();
              locked = true;
              render();
            };
            elChoices.appendChild(retry);
          }
        };
        elChoices.appendChild(b);
      });
    }
  }

  function goPrev(){
    if(idx > 0){
      idx--;
      locked = false;
      render();
    }
  }

  function goNext(){
    const step = SCRIPT[idx];

    if(step && step.goto){
      window.location.href = step.goto;
      return;
    }

    if(idx < SCRIPT.length - 1){
      idx++;
      render();
    }
  }

  elNext.addEventListener("click", (e)=>{ e.stopPropagation(); if(!locked) goNext(); });
  elPrev.addEventListener("click", (e)=>{ e.stopPropagation(); if(!locked) goPrev(); });

  stage.addEventListener("click", ()=>{
    if(!locked) goNext();
  });

  render();
  function goWorldMap(){
  // í˜„ì¬ ì”¬ idë¥¼ worldmapì— ì „ë‹¬
  // ì˜ˆ: department, convenience, hospital ë“±
  const CURRENT_PLACE = "{{ current_place|default('park') }}";
  window.location.href = `/travel/worldmap?current=${CURRENT_PLACE}`;
}

</script>
{% endblock %}
