{# templates/travel/hospital_1.html #}
{% extends "base.html" %}

{% set page_title = "ë³‘ì› | ì¼ë³¸ ì—¬í–‰ ì‹œë®¬ë ˆì´ì…˜" %}
{% set page_desc = "ë³‘ì›ì—ì„œ ì¦ìƒì„ ë§í•˜ê³  ë„ì›€ì„ ë°›ëŠ” ì¼ë³¸ì–´ íšŒí™” ìƒí™©" %}
{% set page_robots = "noindex,nofollow" %}

{% block content %}
<style>
  .travel-wrap{ max-width:1080px; margin:0 auto; padding:22px 18px 48px; }
  .stage{
    position:relative; width:100%; aspect-ratio:16/9;
    border-radius:18px; overflow:hidden;
    box-shadow:0 18px 40px rgba(2,8,23,.20);
    background:#0b1220;
  }
  .bg{
    position:absolute; inset:0;
    background:url('{{ url_for("static", filename="travel/bg/hospital.png") }}') center/cover no-repeat;
  }
  .char{
    position:absolute; left:50%; bottom:14%;
    transform:translateX(-50%);
    width:clamp(340px,46%,520px);
    max-height:84%;
    object-fit:contain;
    pointer-events:none;
    filter:drop-shadow(0 18px 30px rgba(0,0,0,.35));
  }
  .hud{ position:absolute; left:16px; top:14px; display:flex; gap:10px; z-index:5; }
  .chip{
    background:rgba(255,255,255,.90);
    border:1px solid rgba(226,232,240,.9);
    border-radius:999px;
    padding:8px 12px;
    font-weight:900; font-size:13px; color:#0f172a;
  }
  .box{
    position:absolute; left:0; right:0; bottom:0;
    padding:16px 18px 18px;
    background:rgba(54,17,92,.88);
    backdrop-filter:blur(6px);
    z-index:6; min-height:170px;
  }
  .name{ font-weight:900; color:#fff; margin:0 0 8px 0; font-size:16px; }
  .line{ color:#fff; font-size:16px; line-height:1.55; white-space:pre-line; margin:0; }
  .right-hint{ position:absolute; right:18px; top:16px; color:rgba(255,255,255,.75); font-size:12px; font-weight:800; }
  .choices{ margin-top:12px; display:flex; flex-wrap:wrap; gap:10px; }
  .choice-btn{
    background:rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.22);
    color:#fff; border-radius:12px;
    padding:10px 12px; font-weight:900;
    cursor:pointer; transition:transform .08s ease, background .12s ease;
  }
  .choice-btn:hover{ transform:translateY(-1px); background:rgba(255,255,255,.16); }
  .controls{ position:absolute; right:16px; bottom:16px; display:flex; gap:10px; }
  .navbtn{
    background:rgba(255,255,255,.14);
    border:1px solid rgba(255,255,255,.22);
    color:#fff; border-radius:12px;
    padding:10px 14px; font-weight:900; cursor:pointer;
  }
  .navbtn:disabled{ opacity:.45; cursor:not-allowed; }
  .worldmap-btn{
  position:absolute;
  top:14px;
  right:16px;
  z-index:20;
}

.worldmap-btn button{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 14px;
  border-radius:999px;
  background: rgba(255,255,255,.92);
  border:1px solid rgba(226,232,240,.95);
  box-shadow: 0 10px 18px rgba(2,8,23,.12);
  font-size:13px;
  font-weight:1000;
  color:#0f172a;
  cursor:pointer;
  transition: transform .1s ease, box-shadow .12s ease;
}

.worldmap-btn button:hover{
  transform: translateY(-1px);
  box-shadow: 0 14px 24px rgba(2,8,23,.18);
}

</style>

<div class="travel-wrap">
  <div class="stage" id="stage">
    <div class="bg"></div>
<!-- âœ… ì›”ë“œë§µ ë³µê·€ ë²„íŠ¼ -->
<div class="worldmap-btn">
  <button onclick="goWorldMap()">ğŸ—ºï¸ ì›”ë“œë§µìœ¼ë¡œ</button>
</div>

    <div class="hud">
      <div class="chip">ë³‘ì›</div>
      <div class="chip" id="count">1 / 1</div>
    </div>

    <img class="char"
         src="{{ url_for('static', filename='travel/char/hospital_staff.png') }}"
         alt="hospital_staff">

    <div class="box">
      <div class="right-hint" id="hint">í´ë¦­ ë˜ëŠ” ë‹¤ìŒ ë²„íŠ¼ìœ¼ë¡œ ì§„í–‰</div>
      <p class="name" id="speaker">ë‚´ë ˆì´ì…˜</p>
      <p class="line" id="line"></p>

      <div class="choices" id="choices" style="display:none;"></div>

      <div class="controls">
        <button class="navbtn" id="prevBtn">ì´ì „</button>
        <button class="navbtn" id="nextBtn">ë‹¤ìŒ</button>
      </div>
    </div>
  </div>
</div>

<script>
  function fmt(jp, kana, ko){
    return `${jp}\n${kana}\n(${ko})`;
  }

  // âœ… ë³‘ì›: ì¦ìƒ ë§í•˜ê¸° â†’ ì•½/ì§„ë£Œ â†’ ì—”ë”©
  const SCRIPT = [
    { type:"line", speaker:"ë‚´ë ˆì´ì…˜",
      jp:"ä½“èª¿ãŒæ‚ªãã¦ã€ç—…é™¢ã«æ¥ã¾ã—ãŸã€‚",
      kana:"íƒ€ì´ì´ˆ-ê°€ ì™€ë£¨ì¿ í…Œ, ëµ¤-ì¸ë‹ˆ í‚¤ë§ˆì‹œíƒ€.",
      ko:"ëª¸ì´ ì•ˆ ì¢‹ì•„ì„œ ë³‘ì›ì— ì™”ìŠµë‹ˆë‹¤."
    },
    { type:"line", speaker:"ì§ì›",
      jp:"ã“ã‚“ã«ã¡ã¯ã€‚ã©ã†ã•ã‚Œã¾ã—ãŸã‹ï¼Ÿ",
      kana:"ì½˜ë‹ˆì¹˜ì™€. ë„-ì‚¬ë ˆë§ˆì‹œíƒ€ì¹´?",
      ko:"ì•ˆë…•í•˜ì„¸ìš”. ì–´ë””ê°€ ì•ˆ ì¢‹ìœ¼ì‹ ê°€ìš”?"
    },

    // âœ… ë¬¸ì œ 1: ë°°ê°€ ì•„íŒŒìš”
{ type:"choice", speaker:"ë‚˜",
  question_ko:"(ë¬¸ì œ) â€œë°°ê°€ ì•„íŒŒìš”â€ë¥¼ ê°€ì¥ ìì—°ìŠ¤ëŸ½ê²Œ ë§í•˜ë©´?",
  choices:[
    { jp:"è¶³ãŒç—›ã„ã§ã™ã€‚",
      kana:"ì•„ì‹œê°€ ì´íƒ€ì´ ë°ìŠ¤.",
      ko:"ë‹¤ë¦¬ê°€ ì•„íŒŒìš”.",
      correct:false
    },
    { jp:"é ­ãŒç—›ã„ã§ã™ã€‚",
      kana:"ì•„íƒ€ë§ˆê°€ ì´íƒ€ì´ ë°ìŠ¤.",
      ko:"ë¨¸ë¦¬ê°€ ì•„íŒŒìš”.",
      correct:false
    },
    { jp:"ãŠè…¹ãŒç—›ã„ã§ã™ã€‚",
      kana:"ì˜¤ë‚˜ì¹´ê°€ ì´íƒ€ì´ ë°ìŠ¤.",
      ko:"ë°°ê°€ ì•„íŒŒìš”.",
      correct:true
    },
  ]
},


    { type:"line", speaker:"ì§ì›",
      jp:"ã‚ã‹ã‚Šã¾ã—ãŸã€‚ã“ã¡ã‚‰ã«ãŠåå‰ã‚’ã”è¨˜å…¥ãã ã•ã„ã€‚",
      kana:"ì™€ì¹´ë¦¬ë§ˆì‹œíƒ€. ì½”ì¹˜ë¼ë‹ˆ ì˜¤ë‚˜ë§ˆì—ì˜¤ ê³ í‚¤ë‰´- ì¿ ë‹¤ì‚¬ì´.",
      ko:"ì•Œê² ìŠµë‹ˆë‹¤. ì—¬ê¸° ì´ë¦„ì„ ì‘ì„±í•´ì£¼ì„¸ìš”."
    },
    { type:"line", speaker:"ë‚´ë ˆì´ì…˜",
      jp:"å°‘ã—å¾…ã£ã¦ã€è¨ºå¯Ÿã‚’å—ã‘ã¾ã—ãŸã€‚",
      kana:"ìŠ¤ì½”ì‹œ ë§›í…Œ, ì‹ ì‚¬ì¸ ì˜¤ ìš°ì¼€ë§ˆì‹œíƒ€.",
      ko:"ì¡°ê¸ˆ ê¸°ë‹¤ë¦° ë’¤ ì§„ë£Œë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤."
    },

    // âœ… ë¬¸ì œ 2: ì•½ ìˆë‚˜ìš”?
{ type:"choice", speaker:"ë‚˜",
  question_ko:"(ë¬¸ì œ) â€œì•½ì´ ìˆë‚˜ìš”?â€ë¥¼ ì •ì¤‘í•˜ê²Œ ë¬¼ì–´ë³´ë ¤ë©´?",
  choices:[
    { jp:"æ³¨å°„ã‚’æ‰“ã¡ã¾ã™ã‹ï¼Ÿ",
      kana:"ì¸„-ìƒ¤ì˜¤ ìš°ì¹˜ë§ˆìŠ¤ì¹´?",
      ko:"ì£¼ì‚¬ë¥¼ ë§ë‚˜ìš”?",
      correct:false
    },
    { jp:"è–¬ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
      kana:"ì¿ ìŠ¤ë¦¬ì™€ ì•„ë¦¬ë§ˆìŠ¤ì¹´?",
      ko:"ì•½ì´ ìˆë‚˜ìš”?",
      correct:true
    },
    { jp:"æ˜æ—¥ã‚‚æ¥ãŸã»ã†ãŒã„ã„ã§ã™ã‹ï¼Ÿ",
      kana:"ì•„ì‹œíƒ€ëª¨ í‚¤íƒ€ í˜¸-ê°€ ì´ì´ ë°ìŠ¤ì¹´?",
      ko:"ë‚´ì¼ë„ ì™€ì•¼ í•˜ë‚˜ìš”?",
      correct:false
    },
  ]
},


    { type:"line", speaker:"ì§ì›",
      jp:"ã¯ã„ã€‚ãŠè–¬ã‚’ãŠå‡ºã—ã—ã¾ã™ã€‚ãŠå¤§äº‹ã«ã€‚",
      kana:"í•˜ì´. ì˜¤ì¿ ìŠ¤ë¦¬ì˜¤ ì˜¤ë‹¤ì‹œ ì‹œë§ˆìŠ¤. ì˜¤ë‹¤ì´ì§€ë‹ˆ.",
      ko:"ë„¤. ì•½ì„ ì²˜ë°©í•´ë“œë¦´ê²Œìš”. ëª¸ì¡°ë¦¬í•˜ì„¸ìš”."
    },

    // âœ… ì—”ë”©
    { type:"line", speaker:"ë‚´ë ˆì´ì…˜",
      jp:"å°‘ã—å®‰å¿ƒã—ã¾ã—ãŸã€‚æ¬¡ã¯ã©ã“ã¸è¡Œã£ã¦ã¿ã¾ã—ã‚‡ã†ã‹ï¼Ÿ",
      kana:"ìŠ¤ì½”ì‹œ ì•ˆì‹ ì‹œë§ˆì‹œíƒ€. ì¸ ê¸°ì™€ ë„ì½”ì— ì‡í…Œë¯¸ë§ˆì‡¼-ì¹´?",
      ko:"ì¡°ê¸ˆ ì•ˆì‹¬ì´ ëì–´. ë‹¤ìŒì€ ì–´ë””ë¡œ ê°€ë³¼ê¹Œ?",
      goto:"/travel/worldmap?current=hospital"
    },
  ];

  let idx = 0;
  let locked = false;

  const elSpeaker = document.getElementById("speaker");
  const elLine = document.getElementById("line");
  const elChoices = document.getElementById("choices");
  const elPrev = document.getElementById("prevBtn");
  const elNext = document.getElementById("nextBtn");
  const elCount = document.getElementById("count");
  const stage = document.getElementById("stage");

  function render(){
    elCount.textContent = `${Math.min(idx+1, SCRIPT.length)} / ${SCRIPT.length}`;
    elPrev.disabled = (idx <= 0) || locked;

    const step = SCRIPT[idx];
    if(!step) return;

    elChoices.style.display = "none";
    elChoices.innerHTML = "";
    elNext.disabled = locked;

    if(step.type === "line"){
      elSpeaker.textContent = step.speaker || "";
      elLine.textContent = fmt(step.jp || "", step.kana || "", step.ko || "");
      elNext.disabled = false;
      return;
    }

    if(step.type === "choice"){
      elSpeaker.textContent = step.speaker || "";
      elLine.textContent = step.question_ko ? step.question_ko : "ì„ íƒì§€ë¥¼ ê³¨ë¼ì£¼ì„¸ìš”.";
      locked = true;
      elNext.disabled = true;

      elChoices.style.display = "flex";
      step.choices.forEach((c)=>{
        const b = document.createElement("button");
        b.className = "choice-btn";
        b.textContent = `${c.jp}  /  ${c.kana}`;
        b.onclick = (e)=>{
          e.stopPropagation();
          elLine.textContent = `${c.jp}\n${c.kana}\n(${c.ko})`;

          if(c.correct){
            locked = false;
            elNext.disabled = false;
            elPrev.disabled = (idx <= 0);
            elChoices.style.display = "none";
          }else{
            elChoices.innerHTML = "";
            const retry = document.createElement("button");
            retry.className = "choice-btn";
            retry.textContent = "ë‹¤ì‹œ ì„ íƒí•˜ê¸°";
            retry.onclick = (ev)=>{
              ev.stopPropagation();
              locked = true;
              render();
            };
            elChoices.appendChild(retry);
          }
        };
        elChoices.appendChild(b);
      });
    }
  }

  function goPrev(){
    if(idx > 0){
      idx--;
      locked = false;
      render();
    }
  }

  function goNext(){
    const step = SCRIPT[idx];
    if(step && step.goto){
      window.location.href = step.goto;
      return;
    }
    if(idx < SCRIPT.length - 1){
      idx++;
      render();
    }
  }

  elNext.addEventListener("click", (e)=>{ e.stopPropagation(); if(!locked) goNext(); });
  elPrev.addEventListener("click", (e)=>{ e.stopPropagation(); if(!locked) goPrev(); });
  stage.addEventListener("click", ()=>{ if(!locked) goNext(); });

  render();
  function goWorldMap(){
  // í˜„ì¬ ì”¬ idë¥¼ worldmapì— ì „ë‹¬
  // ì˜ˆ: department, convenience, hospital ë“±
  const CURRENT_PLACE = "{{ current_place|default('hospital') }}";
  window.location.href = `/travel/worldmap?current=${CURRENT_PLACE}`;
}

</script>
{% endblock %}
