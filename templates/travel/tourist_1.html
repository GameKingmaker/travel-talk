{# templates/travel/tourist_1.html #}
{% extends "base.html" %}

{% set page_title = "ê´€ê´‘ì§€ | ì¼ë³¸ ì—¬í–‰ ì‹œë®¬ë ˆì´ì…˜" %}
{% set page_desc = "ê´€ê´‘ì§€ì—ì„œ ì•ˆë‚´ ì§ì›ì—ê²Œ ê¸¸ì„ ë¬»ëŠ” ìƒí™©" %}
{% set page_robots = "noindex,nofollow" %}

{% block content %}
<style>
  .travel-wrap{ max-width:1080px; margin:0 auto; padding:22px 18px 48px; }
  .stage{
    position:relative; width:100%; aspect-ratio:16/9;
    border-radius:18px; overflow:hidden;
    box-shadow:0 18px 40px rgba(2,8,23,.20);
    background:#0b1220;
  }
  .bg{
    position:absolute; inset:0;
    background:url('{{ url_for("static", filename="travel/bg/tourist.png") }}') center/cover no-repeat;
  }
  .char{
    position:absolute; left:50%; bottom:14%;
    transform:translateX(-50%);
    width:clamp(340px,46%,520px);
    max-height:84%;
    object-fit:contain;
    pointer-events:none;
    filter:drop-shadow(0 18px 30px rgba(0,0,0,.35));
  }
  .hud{ position:absolute; left:16px; top:14px; display:flex; gap:10px; z-index:5; }
  .chip{
    background:rgba(255,255,255,.9);
    border:1px solid rgba(226,232,240,.9);
    border-radius:999px;
    padding:8px 12px;
    font-weight:900; font-size:13px; color:#0f172a;
  }
  .box{
    position:absolute; left:0; right:0; bottom:0;
    padding:16px 18px 18px;
    background:rgba(54,17,92,.88);
    backdrop-filter:blur(6px);
    min-height:170px; z-index:6;
  }
  .name{ font-weight:900; color:#fff; margin-bottom:8px; }
  .line{ color:#fff; line-height:1.55; white-space:pre-line; }
  .right-hint{ position:absolute; right:18px; top:16px; color:rgba(255,255,255,.75); font-size:12px; font-weight:800; }
  .choices{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
  .choice-btn{
    background:rgba(255,255,255,.1);
    border:1px solid rgba(255,255,255,.22);
    color:#fff; padding:10px 12px;
    border-radius:12px; font-weight:900;
    cursor:pointer;
    transition: transform .08s ease, background .12s ease;
  }
  .choice-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.16); }
  .controls{ position:absolute; right:16px; bottom:16px; display:flex; gap:10px; }
  .navbtn{
    background:rgba(255,255,255,.14);
    border:1px solid rgba(255,255,255,.22);
    color:#fff; padding:10px 14px;
    border-radius:12px; font-weight:900;
  }
  .navbtn:disabled{ opacity:.45; cursor:not-allowed; }
  .worldmap-btn{
  position:absolute;
  top:14px;
  right:16px;
  z-index:20;
}

.worldmap-btn button{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 14px;
  border-radius:999px;
  background: rgba(255,255,255,.92);
  border:1px solid rgba(226,232,240,.95);
  box-shadow: 0 10px 18px rgba(2,8,23,.12);
  font-size:13px;
  font-weight:1000;
  color:#0f172a;
  cursor:pointer;
  transition: transform .1s ease, box-shadow .12s ease;
}

.worldmap-btn button:hover{
  transform: translateY(-1px);
  box-shadow: 0 14px 24px rgba(2,8,23,.18);
}

</style>

<div class="travel-wrap">
  <div class="stage" id="stage">
    <div class="bg"></div>
<!-- âœ… ì›”ë“œë§µ ë³µê·€ ë²„íŠ¼ -->
<div class="worldmap-btn">
  <button onclick="goWorldMap()">ğŸ—ºï¸ ì›”ë“œë§µìœ¼ë¡œ</button>
</div>

    <div class="hud">
      <div class="chip">ê´€ê´‘ì§€</div>
      <div class="chip" id="count">1 / 1</div>
    </div>

    <img class="char" src="{{ url_for('static', filename='travel/char/tourist_staff.png') }}" alt="tourist_staff">

    <div class="box">
      <div class="right-hint">í´ë¦­ ë˜ëŠ” ë‹¤ìŒ ë²„íŠ¼ìœ¼ë¡œ ì§„í–‰</div>
      <p class="name" id="speaker"></p>
      <p class="line" id="line"></p>

      <div class="choices" id="choices" style="display:none"></div>

      <div class="controls">
        <button class="navbtn" id="prevBtn">ì´ì „</button>
        <button class="navbtn" id="nextBtn">ë‹¤ìŒ</button>
      </div>
    </div>
  </div>
</div>

<script>
function fmt(jp,kana,ko){ return `${jp}\n${kana}\n(${ko})`; }

const SCRIPT = [
  { type:"line", speaker:"ë‚´ë ˆì´ì…˜",
    jp:"æœ‰åãªè¦³å…‰åœ°ã«åˆ°ç€ã—ã¾ã—ãŸã€‚",
    kana:"ìœ -ë©”-ë‚˜ ì¹¸ì½”-ì¹˜ë‹ˆ í† -ì°¨ì¿  ì‹œë§ˆì‹œíƒ€.",
    ko:"ìœ ëª…í•œ ê´€ê´‘ì§€ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤."
  },
  { type:"line", speaker:"ì§ì›",
    jp:"ã“ã‚“ã«ã¡ã¯ã€‚ã”æ¡ˆå†…ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ",
    kana:"ì½˜ë‹ˆì¹˜ì™€. ê³ ì•ˆë‚˜ì´ ì‹œë§ˆì‡¼-ì¹´?",
    ko:"ì•ˆë…•í•˜ì„¸ìš”. ì•ˆë‚´í•´ë“œë¦´ê¹Œìš”?"
  },

  // âœ… ë¬¸ì œ: ì „ë§ëŒ€ ìœ„ì¹˜ ë¬»ê¸°
{ type:"choice", speaker:"ë‚˜",
  question_ko:"(ë¬¸ì œ) ì „ë§ëŒ€ê°€ ì–´ë””ì¸ì§€ ì •ì¤‘í•˜ê²Œ ë¬¼ì–´ë³´ë ¤ë©´?",
  choices:[
    { jp:"æ­©ã„ã¦è¡Œãã¾ã™ã‹ï¼Ÿ",
      kana:"ì•„ë£¨ì´í…Œ ì´í‚¤ë§ˆìŠ¤ì¹´?",
      ko:"ê±¸ì–´ì„œ ê°€ì•¼ í•˜ë‚˜ìš”?",
      correct:false
    },
    { jp:"å±•æœ›å°ã¯ã©ã“ã§ã™ã‹ï¼Ÿ",
      kana:"í…ë³´-ë‹¤ì´ì™€ ë„ì½” ë°ìŠ¤ì¹´?",
      ko:"ì „ë§ëŒ€ëŠ” ì–´ë””ì¸ê°€ìš”?",
      correct:true
    },
    { jp:"å†™çœŸã‚’æ’®ã£ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ",
      kana:"ìƒ¤ì‹ ì˜¤ í†³í…Œëª¨ ì´ì´ ë°ìŠ¤ì¹´?",
      ko:"ì‚¬ì§„ ì°ì–´ë„ ë˜ë‚˜ìš”?",
      correct:false
    }
  ]
},

  { type:"line", speaker:"ì§ì›",
    jp:"ã“ã“ã‚’ã¾ã£ã™ãè¡Œã£ã¦ã€å·¦ã«æ›²ãŒã‚‹ã¨è¦‹ãˆã¾ã™ã€‚",
    kana:"ì½”ì½”ì˜¤ ë§›ìŠ¤êµ¬ ì‡í…Œ, íˆë‹¤ë¦¬ë‹ˆ ë§ˆê°€ë£¨í†  ë¯¸ì—ë§ˆìŠ¤.",
    ko:"ì—¬ê¸¸ ê³§ì¥ ê°€ì„œ ì™¼ìª½ìœ¼ë¡œ êº¾ìœ¼ë©´ ë³´ì—¬ìš”."
  },
  { type:"line", speaker:"ë‚´ë ˆì´ì…˜",
    jp:"æ¡ˆå†…ã•ã‚ŒãŸé“ã‚’æ­©ã„ã¦ã„ãã¾ã™ã€‚",
    kana:"ì•ˆë‚˜ì´ì‚¬ë ˆíƒ€ ë¯¸ì¹˜ì˜¤ ì•„ë£¨ì´í…Œ ì´í‚¤ë§ˆìŠ¤.",
    ko:"ì•ˆë‚´ë°›ì€ ê¸¸ë¡œ ê±¸ì–´ê°‘ë‹ˆë‹¤."
  },
  { type:"line", speaker:"ë‚´ë ˆì´ì…˜",
    jp:"æ™¯è‰²ãŒã¨ã¦ã‚‚ãã‚Œã„ã§ã—ãŸã€‚",
    kana:"ì¼€ì‹œí‚¤ê°€ í† í…Œëª¨ í‚¤ë ˆì´ ë°ì‹œíƒ€.",
    ko:"í’ê²½ì´ ì •ë§ ì•„ë¦„ë‹¤ì› ì–´ìš”."
  },

  // âœ… ì—”ë”©
  { type:"line", speaker:"ë‚´ë ˆì´ì…˜",
    jp:"æœ¬å½“ã«æ¥½ã—ã‹ã£ãŸã§ã™ï¼æ¬¡ã¯ã©ã“ã¸è¡Œã£ã¦ã¿ã¾ã—ã‚‡ã†ã‹ï¼Ÿ",
    kana:"í˜¼í† -ë‹ˆ íƒ€ë…¸ì‹œìº‡íƒ€ ë°ìŠ¤! ì¸ ê¸°ì™€ ë„ì½”ì— ì‡í…Œë¯¸ë§ˆì‡¼-ì¹´?",
    ko:"ì •ë§ ì¬ë°Œì—ˆì–´. ë‹¤ìŒì€ ì–´ë””ë¡œ ê°€ë³¼ê¹Œ?",
    goto:"/travel/worldmap?current=tourist"
  }
];

let idx=0, locked=false;
const sp=document.getElementById("speaker");
const ln=document.getElementById("line");
const ch=document.getElementById("choices");
const prev=document.getElementById("prevBtn");
const next=document.getElementById("nextBtn");
const cnt=document.getElementById("count");
const stage=document.getElementById("stage");

function render(){
  cnt.textContent=`${Math.min(idx+1,SCRIPT.length)} / ${SCRIPT.length}`;
  prev.disabled=(idx<=0)||locked;
  const s=SCRIPT[idx];
  ch.style.display="none"; ch.innerHTML="";
  next.disabled=locked;

  if(s.type==="line"){
    sp.textContent=s.speaker;
    ln.textContent=fmt(s.jp,s.kana,s.ko);
    next.disabled=false;
    return;
  }

  if(s.type==="choice"){
    sp.textContent=s.speaker;
    ln.textContent=s.question_ko;
    locked=true; next.disabled=true;
    ch.style.display="flex";
    s.choices.forEach(c=>{
      const b=document.createElement("button");
      b.className="choice-btn";
      b.textContent=`${c.jp} / ${c.kana}`;
      b.onclick=(e)=>{
        e.stopPropagation();
        ln.textContent=fmt(c.jp,c.kana,c.ko);
        if(c.correct){
          locked=false; next.disabled=false; ch.style.display="none";
        }else{
          ch.innerHTML="";
          const r=document.createElement("button");
          r.className="choice-btn";
          r.textContent="ë‹¤ì‹œ ì„ íƒ";
          r.onclick=(ev)=>{ ev.stopPropagation(); render(); };
          ch.appendChild(r);
        }
      };
      ch.appendChild(b);
    });
  }
}

prev.onclick=()=>{ if(idx>0){ idx--; locked=false; render(); } };
next.onclick=()=>{
  const s=SCRIPT[idx];
  if(s.goto){ location.href=s.goto; return; }
  if(!locked && idx<SCRIPT.length-1){ idx++; render(); }
};
stage.onclick=()=>{ if(!locked) next.onclick(); };

render();
function goWorldMap(){
  // í˜„ì¬ ì”¬ idë¥¼ worldmapì— ì „ë‹¬
  // ì˜ˆ: department, convenience, hospital ë“±
  const CURRENT_PLACE = "{{ current_place|default('tourist') }}";
  window.location.href = `/travel/worldmap?current=${CURRENT_PLACE}`;
}

</script>
{% endblock %}
