{# templates/travel/travel_map.html #}
{% extends "base.html" %}

{% set page_title = "ì—¬í–‰ ì›”ë“œë§µ | ì¼ë³¸ ì—¬í–‰ ì‹œë®¬ë ˆì´ì…˜" %}
{% set page_desc = "ì›”ë“œë§µì—ì„œ ì¥ì†Œë¥¼ ì„ íƒí•´ ì¥ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤." %}
{% set page_robots = "noindex,nofollow" %}

{% block content %}
<style>
  :root{
    --bg1:#eaf1ff;
    --panel:#ffffff;
    --ink:#0f172a;
    --muted:#64748b;
    --shadow: 0 10px 30px rgba(2,8,23,.08);
  }
  *{box-sizing:border-box}

  .travel-page{
    background: linear-gradient(180deg, var(--bg1), #f7fbff);
    color:var(--ink);
    padding: 22px 0 48px;
  }

  .wrap{
    max-width: 1080px;
    margin: 0 auto;
    padding: 0 16px;
  }

  /* âœ… ìƒë‹¨ í—¤ë” ì˜ˆì˜ê²Œ */
  .topbar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:14px;
    margin-bottom: 14px;

    padding: 14px 16px;
    border-radius: 18px;
    background: rgba(255,255,255,.72);
    border: 1px solid rgba(226,232,240,.9);
    box-shadow: 0 10px 26px rgba(2,8,23,.08);
    backdrop-filter: blur(8px);
  }

  .top-left{
    display:flex;
    align-items:center;
    gap:12px;
    min-width: 0;
  }

  .badge{
    width:44px;
    height:44px;
    border-radius: 14px;
    display:grid;
    place-items:center;
    background: radial-gradient(circle at 30% 30%, rgba(99,102,241,.18), rgba(14,165,233,.10));
    border: 1px solid rgba(37,99,235,.14);
    box-shadow: 0 10px 18px rgba(2,8,23,.08);
    flex: 0 0 auto;
    font-size: 20px;
  }

  .titles{
    display:flex;
    flex-direction:column;
    gap:4px;
    min-width:0;
  }
  .title{
    font-size: 20px;
    font-weight: 1000;
    letter-spacing:-.02em;
    line-height:1.15;
    margin:0;
    white-space: nowrap;
    overflow:hidden;
    text-overflow: ellipsis;
  }
  .hint{
    font-size: 12.5px;
    color: rgba(71,85,105,.95);
    font-weight: 800;
    margin:0;
    white-space: nowrap;
    overflow:hidden;
    text-overflow: ellipsis;
  }

  .top-right{
    display:flex;
    align-items:center;
    gap:10px;
    flex: 0 0 auto;
  }
  .top-btn{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 10px 12px;
    border-radius: 999px;
    background: rgba(255,255,255,.92);
    border: 1px solid rgba(226,232,240,.95);
    box-shadow: 0 10px 18px rgba(2,8,23,.08);
    color:#0f172a;
    font-weight: 1000;
    font-size: 12.5px;
    cursor:pointer;
    transition: transform .10s ease, box-shadow .12s ease, border-color .12s ease;
  }
  .top-btn:hover{
    transform: translateY(-1px);
    border-color: rgba(37,99,235,.22);
    box-shadow: 0 14px 22px rgba(2,8,23,.10);
  }
  .top-btn:active{ transform: translateY(0); }

  .pill-mini{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding: 8px 10px;
    border-radius: 999px;
    background: rgba(241,245,255,.9);
    border: 1px solid rgba(37,99,235,.18);
    color:#1d4ed8;
    font-weight: 1000;
    font-size: 12px;
  }
  .pill-mini .dot{
    width:8px; height:8px;
    border-radius:999px;
    background: rgba(37,99,235,.9);
    box-shadow: 0 0 0 3px rgba(37,99,235,.14);
  }

  @media (max-width: 860px){
    .hint{ white-space: normal; }
    .title{ white-space: normal; }
  }

  .map-card{
    background: var(--panel);
    border-radius: 20px;
    box-shadow: var(--shadow);
    overflow: hidden;
    position: relative;
  }

  .map{
    position: relative;
    width: 100%;
    aspect-ratio: 16 / 9;
    min-height: 520px;

    background:
      radial-gradient(circle at 20% 30%, rgba(99,102,241,.12), transparent 45%),
      radial-gradient(circle at 75% 35%, rgba(14,165,233,.10), transparent 45%),
      radial-gradient(circle at 55% 75%, rgba(34,197,94,.10), transparent 45%),
      linear-gradient(180deg, #f6f9ff, #eef5ff);

    overflow: hidden;
  }

  /* âœ… ì›”ë“œë§µ ë°°ê²½ ì´ë¯¸ì§€ ë ˆì´ì–´ (ë¬¸ë²• ì˜¤ë¥˜ ì—†ê²Œ ì •ë¦¬) */
  .map::before{
    content:"";
    position:absolute;
    inset:0;
    background-image: url("{{ url_for('static', filename='travel/worldmap_bg.png') }}");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;

    opacity: .40;
    filter: blur(0.2px) brightness(1.3) saturate(1.08) contrast(1.05);

    transform: scale(1.02);
    z-index: 0;
    pointer-events: none;
  }

  /* âœ… map ì•ˆì˜ UIëŠ” ë°°ê²½ë³´ë‹¤ ìœ„ */
  .map > *{
    position: relative;
    z-index: 1;
  }

  /* âœ… ZONE: ë°”ê¹¥ì„  ì„ ëª… + ë‚´ë¶€ëŠ” ê±°ì˜ íˆ¬ëª… */
  .zone{
    position:absolute;
    border-radius: 24px;
    padding: 14px 14px 12px;
    overflow: hidden;

    background: rgba(255,255,255,.12);     /* íˆ¬ëª…í•˜ê²Œ */
    backdrop-filter: none;
    -webkit-backdrop-filter: none;

    border: 2px dashed rgba(255,255,255,.55); /* ì„ ëª…í•œ ì ì„  */
    box-shadow:
      0 0 0 1px rgba(15,23,42,.25),        /* ì™¸ê³½ì„  ì¶”ê°€ ê°•ì¡° */
      0 12px 28px rgba(2,8,23,.12);        /* ì‚´ì§ ë–  ë³´ì´ê²Œ */
  }

  /* âœ… ZONE ì œëª©: ë°°ê²½ ë‹¬ì•„ì¤˜ì„œ ë¬´ì¡°ê±´ ì„ ëª… */
  .zone .zlabel{
    font-size: 13px;
    font-weight: 1000;
    letter-spacing: -.01em;
    color: #0f172a;

    background: rgba(255,255,255,.86);
    padding: 6px 12px;
    border-radius: 999px;
    display: inline-block;
    margin: 0 0 12px 4px;

    box-shadow:
      0 6px 14px rgba(2,8,23,.18),
      0 0 0 1px rgba(255,255,255,.8) inset;
  }

  /* âœ… 1ì¤„ 1ê°œë¡œ ê³ ì • */
  .zgrid{
    display:grid;
    grid-template-columns: 1fr;
    gap: 10px;
    align-content: start;
  }

  /* âœ… ì¥ì†Œ ë²„íŠ¼: ë” ì„ ëª…(ë¶ˆíˆ¬ëª…+ê°•í•œ ê·¸ë¦¼ì+ë°°ê²½ ì˜í–¥ ì œê±°) */
  .node{
    position:relative;
    z-index: 5; /* ë°°ê²½ë³´ë‹¤ í™•ì‹¤íˆ ìœ„ */
    display:flex; align-items:center; gap:10px;
    padding: 10px 12px;
    padding-right: 70px;
    border-radius: 999px;

    background: rgba(255,255,255,.95);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;

    border: 1px solid rgba(226,232,240,.95);
    box-shadow:
      0 10px 22px rgba(2,8,23,.18),
      0 0 0 1px rgba(255,255,255,.6) inset;

    cursor:pointer;
    user-select:none;
    transition: transform .10s ease, box-shadow .12s ease, border-color .12s ease;
    min-height: 44px;
  }
  .node:hover{
    transform: translateY(-2px) scale(1.01);
    box-shadow:
      0 16px 28px rgba(2,8,23,.22),
      0 0 0 1px rgba(37,99,235,.25);
    border-color: rgba(37,99,235,.25);
  }
  .node:active{ transform: translateY(0) scale(1.0); }

  .node .icon{
    width: 26px; height: 26px;
    border-radius: 10px;
    display:grid; place-items:center;

    background: rgba(241,245,255,1);
    border: 1px solid rgba(37,99,235,.22);
    box-shadow: 0 4px 8px rgba(2,8,23,.15);

    font-size: 14px;
    flex: 0 0 auto;
  }

  .node .text{display:flex; flex-direction:column; line-height:1.05; min-width:0;}
  .node .label{
    font-size: 13px;
    font-weight: 1000;
    letter-spacing:-.01em;
    color:#0f172a;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }
  .node .sub{
    font-size: 11px;
    color:#475569;
    font-weight: 800;
    margin-top: 3px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  /* âœ… í˜„ì¬ ìœ„ì¹˜ ë°°ì§€ */
  .node .badge-current{
    position:absolute;
    right:10px;
    top:50%;
    transform: translateY(-50%);
    display:none;
    align-items:center;
    gap:6px;
    padding:6px 10px;
    border-radius:999px;
    font-size:11px;
    font-weight:900;
    color:#0f172a;
    background: rgba(34,197,94,.18);
    border: 1px solid rgba(34,197,94,.35);
  }
  .node.is-current .badge-current{ display:inline-flex; }

  .badge-current .dot{
    width:8px; height:8px;
    border-radius:999px;
    background: rgba(34,197,94,.9);
    box-shadow: 0 0 0 3px rgba(34,197,94,.18);
  }

  /* âœ… í˜„ì¬ ë…¸ë“œ ìì²´ë„ ì‚´ì§ ê°•ì¡° */
  .node.is-current{
    border-color: rgba(34,197,94,.45);
    box-shadow:
      0 16px 28px rgba(2,8,23,.22),
      0 0 0 2px rgba(34,197,94,.22);
  }

  @media (max-width: 860px){
    .map{ min-height: 720px; }
    .zone{ padding: 12px; }
    .node{ border-radius: 16px; }
    .node .label, .node .sub{ white-space: normal; }
  }

  .overlay{
    position:absolute; inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background: rgba(15,23,42,.15);
    backdrop-filter: blur(2px);
    z-index: 10;
  }
  .overlay.on{display:flex}
  .toast{
    background: rgba(255,255,255,.92);
    border: 1px solid rgba(226,232,240,.9);
    box-shadow: var(--shadow);
    border-radius: 16px;
    padding: 14px 16px;
    font-weight: 900;
    color: rgba(15,23,42,.92);
    display:flex; align-items:center; gap:10px;
  }
  .spinner{
    width: 14px; height:14px;
    border: 2px solid rgba(148,163,184,.6);
    border-top-color: rgba(15,23,42,.8);
    border-radius: 999px;
    animation: spin .8s linear infinite;
  }
  @keyframes spin{to{transform: rotate(360deg)}}
</style>


<div class="travel-page">
  <div class="wrap">

    <!-- âœ… ìƒë‹¨ í—¤ë” UI (ì˜ˆì˜ê²Œ) -->
    <div class="topbar">
      <div class="top-left">
        <div class="badge">ğŸ—ºï¸</div>
        <div class="titles">
          <h1 class="title">ì¼ë³¸ ì—¬í–‰ ì›”ë“œë§µ</h1>
          <p class="hint">ì¥ì†Œë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ìƒí™©ì˜ ì¼ë³¸ì–´ íšŒí™” ì‹œë®¬ë ˆì´ì…˜ì´ ì‹œì‘ë©ë‹ˆë‹¤.</p>
        </div>
      </div>
      <div class="top-right">
  <button class="top-btn" onclick="location.href='{{ url_for('travel_start') }}'">
    â®ï¸ ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°
  </button>
</div>

    </div>

    <div class="map-card">
      <div class="map" id="map">

        <!-- âœ… zone ë°°ì¹˜ ê·¸ëŒ€ë¡œ -->
        <div class="zone" style="left:4%;  top:5%;  width:30%; height:40%;">
          <div class="zlabel">START êµ¬ì—­</div>
          <div class="zgrid" id="zone-start"></div>
        </div>

        <div class="zone" style="left:35%; top:15%; width:30%; height:60%;">
          <div class="zlabel">ìˆ™ì†Œ/ì‹œë‚´</div>
          <div class="zgrid" id="zone-city"></div>
        </div>

        <div class="zone" style="left:68%; top:5%;  width:30%; height:40%;">
          <div class="zlabel">ì‡¼í•‘/ì´ë²¤íŠ¸</div>
          <div class="zgrid" id="zone-shop"></div>
        </div>

        <div class="zone" style="left:4%;  top:60%; width:30%; height:40%;">
          <div class="zlabel">í¸ì˜ì‹œì„¤/í™˜ì „ì†Œ</div>
          <div class="zgrid" id="zone-util"></div>
        </div>

        <div class="zone" style="left:68%; top:60%; width:30%; height:40%;">
          <div class="zlabel">ê´€ê´‘/ë†€ì´ê³µì›</div>
          <div class="zgrid" id="zone-tour"></div>
        </div>

        <div class="overlay" id="overlay">
          <div class="toast"><span class="spinner"></span><span id="overlayText">ì´ë™ ì¤‘â€¦</span></div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
  const ZONES = {
    start: [
      {id:"airport", label:"ê³µí•­", icon:"âœˆï¸", scene:"/travel/scene/airport_1"},
    ],
    util: [
      {id:"exchange", label:"í™˜ì „ì†Œ", icon:"ğŸ’±", scene:"/travel/scene/exchange_1"},
      {id:"convenience",  label:"í¸ì˜ì ", icon:"ğŸª", scene:"/travel/scene/convenience_1"},
    ],
    city: [
      {id:"hotel",      label:"í˜¸í…”",   icon:"ğŸ¨", scene:"/travel/scene/hotel_1"},
      {id:"cafe",       label:"ì¹´í˜",   icon:"â˜•", scene:"/travel/scene/cafe_1"},
      {id:"movie",      label:"ì˜í™”ê´€", icon:"ğŸ¬", scene:"/travel/scene/movie_1"},
      {id:"hospital",   label:"ë³‘ì›",   icon:"ğŸ¥", scene:"/travel/scene/hospital_1"},
      {id:"restaurant", label:"ì‹ë‹¹",   icon:"ğŸœ", scene:"/travel/scene/restaurant_1"},
    ],
    shop: [
      {id:"department", label:"ë°±í™”ì ",      icon:"ğŸ›ï¸", scene:"/travel/scene/department_1"},
      {id:"festival",   label:"ì¶•ì œÂ·ì•¼ì‹œì¥", icon:"ğŸ†", scene:"/travel/scene/festival_1"},
    ],
    tour: [
      {id:"park",    label:"ë†€ì´ê³µì›", icon:"ğŸ¡", scene:"/travel/scene/park_1"},
      {id:"tourist", label:"ê´€ê´‘ì§€",   icon:"ğŸ—¾", scene:"/travel/scene/tourist_1"},
      {id:"onsen",   label:"ì˜¨ì²œ",     icon:"â™¨ï¸", scene:"/travel/scene/onsen_1"},
    ]
  };

  // âœ… í˜„ì¬ ìœ„ì¹˜: URL íŒŒë¼ë¯¸í„°(?current=department)ë¡œ ë°›ê¸°
  const params = new URLSearchParams(location.search);
  let current = params.get("current") || "airport";

  const overlay = document.getElementById("overlay");
  const overlayText = document.getElementById("overlayText");

  function updateCurrentUI(){
    document.querySelectorAll(".node").forEach(el=>{
      el.classList.toggle("is-current", el.dataset.id === current);
    });
  }

  function mountZone(zoneId, nodes){
    const root = document.getElementById(zoneId);
    root.innerHTML = "";

    nodes.forEach(n=>{
      const el = document.createElement("div");
      el.className = "node";
      el.dataset.id = n.id;
      el.innerHTML = `
        <div class="icon">${n.icon}</div>
        <div class="text">
          <div class="label">${n.label}</div>
          <div class="sub">í´ë¦­í•´ì„œ ì´ë™</div>
        </div>
        <div class="badge-current" title="í˜„ì¬ ìœ„ì¹˜">
          <span class="dot"></span>í˜„ì¬
        </div>
      `;

      el.addEventListener("click", ()=>{
        overlayText.textContent = "ì´ë™ ì¤‘â€¦";
        overlay.classList.add("on");

        setTimeout(()=>{
          overlay.classList.remove("on");
          current = n.id;
          updateCurrentUI();

          if(n.scene){
            window.location.href = n.scene;
          }
        }, 550);
      });

      root.appendChild(el);
    });
  }

  mountZone("zone-start", ZONES.start);
  mountZone("zone-util",  ZONES.util);
  mountZone("zone-city",  ZONES.city);
  mountZone("zone-shop",  ZONES.shop);
  mountZone("zone-tour",  ZONES.tour);

  updateCurrentUI();
</script>
{% endblock %}
