{% extends "base.html" %}
{% block content %}

<style>
  .rk-wrap{ max-width:1080px; margin:0 auto; padding:22px 18px 56px; }
  .rk-head{ display:flex; align-items:flex-end; justify-content:space-between; gap:14px; margin-bottom:14px; }
  .rk-title{ font-size:34px; font-weight:900; letter-spacing:-0.5px; margin:0; }
  .rk-sub{ margin:6px 0 0; color:#6b7280; font-size:14px; line-height:1.45; }

  .rk-actions{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
  .btn{
    display:inline-flex; align-items:center; justify-content:center;
    height:40px; padding:0 14px;
    border-radius:12px; border:1px solid rgba(15,23,42,0.10);
    background:#fff; color:#0f172a; text-decoration:none; font-weight:800; cursor:pointer;
  }
  .btn.primary{ background:#2563eb; color:#fff; border-color:rgba(37,99,235,0.22); }
  .btn.ghost{ background:#f8fafc; }

  .rk-grid{ display:grid; grid-template-columns: 1.2fr 0.8fr; gap:14px; align-items:start; }
  @media (max-width: 920px){ .rk-grid{ grid-template-columns:1fr; } }

  .card{
    background:#fff;
    border:1px solid rgba(15,23,42,0.10);
    border-radius:18px;
    box-shadow:0 10px 30px rgba(2,8,23,0.06);
    overflow:hidden;
  }

  .card-hd{ padding:14px 16px; border-bottom:1px solid rgba(15,23,42,0.06); display:flex; align-items:center; justify-content:space-between; gap:10px;}
  .card-hd h3{ margin:0; font-size:16px; font-weight:900; letter-spacing:-0.2px; }
  .pill{
    display:inline-flex; align-items:center; justify-content:center;
    padding:4px 10px; border-radius:999px;
    background:#f1f5ff; border:1px solid rgba(37,99,235,0.18);
    color:#1d4ed8; font-weight:900; font-size:12px; white-space:nowrap;
  }

  table{ width:100%; border-collapse:collapse; }
  th, td{ padding:12px 12px; text-align:left; border-bottom:1px solid rgba(15,23,42,0.06); }
  th{ font-size:12px; color:#64748b; font-weight:900; background:#fafcff; }
  td{ font-size:14px; color:#0f172a; }
  .rk-num{ width:62px; color:#475569; font-weight:900; }
  .rk-name{ font-weight:900; }
  .rk-score{ width:110px; font-weight:900; }
  .rk-date{ width:90px; color:#64748b; font-size:12px; }

  /* TOP3 ê°•ì¡° */
  tr.top1 td{ background: rgba(250, 204, 21, 0.10); }
  tr.top2 td{ background: rgba(148, 163, 184, 0.12); }
  tr.top3 td{ background: rgba(249, 115, 22, 0.10); }

  /* ë‚´ ê¸°ë¡ ê°•ì¡° */
  tr.me td{ outline: 2px solid rgba(37,99,235,0.22); outline-offset:-2px; background: rgba(37,99,235,0.06); }

  .muted{ color:#64748b; font-size:12px; }
  .empty{ padding:18px 16px; color:#64748b; }

  .mybox{ padding:14px 16px; }
  .myrow{ display:flex; gap:10px; flex-wrap:wrap; }
  .chip{
    display:flex; align-items:center; gap:8px;
    padding:10px 12px; border-radius:14px;
    background:#fff; border:1px solid rgba(15,23,42,0.10);
  }
  .chip b{ font-weight:900; }
  .chip .val{ font-weight:900; }
  .note{ margin-top:10px; color:#64748b; font-size:12px; line-height:1.5; }
</style>

<div class="rk-wrap">
  <div class="rk-head">
    <div>
      <h1 class="rk-title">ë‹¨ì–´ ê²Œì„ ë­í‚¹</h1>
      <p class="rk-sub">ë­í‚¹ ëª¨ë“œì—ì„œ ê¸°ë¡ëœ <b>ìµœê³  ì ìˆ˜</b> ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ë©ë‹ˆë‹¤.</p>
    </div>
    <div class="rk-actions">
      <a class="btn ghost" href="{{ url_for('word_game') }}">â† ê²Œì„ìœ¼ë¡œ</a>
      <a class="btn ghost" href="{{ url_for('quiz') }}">â† ê²Œì„ ì„ íƒ</a>
      {% if not user %}
        <a class="btn primary" href="{{ url_for('login') }}">ë¡œê·¸ì¸</a>
      {% endif %}
    </div>
  </div>

  <div class="rk-grid">
    <!-- ë­í‚¹ í…Œì´ë¸” -->
    <div class="card">
      <div class="card-hd">
        <h3>TOP 50</h3>
        <span class="pill">ìµœê³ ì ìˆ˜</span>
      </div>

      {% if not top or top|length == 0 %}
        <div class="empty">ì•„ì§ ë­í‚¹ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ë­í‚¹ ëª¨ë“œë¡œ í”Œë ˆì´í•´ë³´ì„¸ìš”!</div>
      {% else %}
        <table>
          <thead>
            <tr>
              <th class="rk-num">ìˆœìœ„</th>
              <th>ë‹‰ë„¤ì„</th>
              <th class="rk-score">ì ìˆ˜</th>
              <th class="rk-date">ë‚ ì§œ</th>
            </tr>
          </thead>
          <tbody>
            {% for row in top %}
              {% set rank = loop.index %}
              {% set is_me = (user and row["id"] == user["id"]) %}
              <tr class="
                {% if rank == 1 %}top1{% elif rank == 2 %}top2{% elif rank == 3 %}top3{% endif %}
                {% if is_me %} me{% endif %}
              ">
              <td class="rk-num">
                  {% if rank == 1 %}ğŸ¥‡
                  {% elif rank == 2 %}ğŸ¥ˆ
                  {% elif rank == 3 %}ğŸ¥‰
                  {% else %}{{ rank }}
                  {% endif %}
                </td>

                <td class="rk-name">
                  {{ row.nickname }}
                  {% if is_me %}
                    <span class="pill" style="margin-left:8px;">ë‚´ ê¸°ë¡</span>
                  {% endif %}
                </td>

                <td class="rk-score">{{ row.score }}ì </td>

                <td class="rk-date">
                  {% if row.at %}
                    {{ row.at[:10] }}
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>

    <!-- ë‚´ ì •ë³´ ì¹´ë“œ -->
    <div class="card">
      <div class="card-hd">
        <h3>ë‚´ ë­í‚¹</h3>
        <span class="pill">ë­í‚¹ ëª¨ë“œ ê¸°ì¤€</span>
      </div>
      <div class="mybox">
        {% if user %}
          <div class="myrow">
            <div class="chip"><b>ë‚´ ìˆœìœ„</b> <span class="val">{% if my_rank %}{{ my_rank }}ìœ„{% else %}-{% endif %}</span></div>
            <div class="chip"><b>ë‚´ ìµœê³ ì </b> <span class="val">{{ my_best or 0 }}ì </span></div>
          </div>
          <div class="note">
            ë­í‚¹ ëª¨ë“œì—ì„œ ê²Œì„ì˜¤ë²„ ì‹œ ìë™ìœ¼ë¡œ ê¸°ë¡ì´ ì €ì¥ë©ë‹ˆë‹¤.<br>
            (ì—°ìŠµ ëª¨ë“œëŠ” ê¸°ë¡ì— ë°˜ì˜ë˜ì§€ ì•Šì•„ìš”)
          </div>
        {% else %}
          <div class="empty">
            ë¡œê·¸ì¸í•˜ë©´ ë‚´ ìˆœìœ„/ìµœê³ ì ì´ í‘œì‹œë©ë‹ˆë‹¤.<br>
            <span class="muted">â€» ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œëŠ” ë­í‚¹ ì €ì¥ì´ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>
          </div>
          <a class="btn primary" style="margin-top:12px;" href="{{ url_for('login') }}">ë¡œê·¸ì¸ í•˜ëŸ¬ê°€ê¸°</a>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
