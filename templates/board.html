{% extends "base.html" %}

{# âœ… ê²Œì‹œíŒ ëª©ë¡ SEO #}
{% set page_title = (q and ("ê²Œì‹œíŒ ê²€ìƒ‰: " ~ q ~ " | ì¼ë³¸ ì—¬í–‰ íšŒí™” ê³µë¶€ë°©") ) or "ì¼ë°˜ê²Œì‹œíŒ | ì¼ë³¸ ì—¬í–‰ íšŒí™” ê³µë¶€ë°©" %}
{% set page_desc = (q and ("ì¼ë°˜ê²Œì‹œíŒì—ì„œ '" ~ q ~ "' ê²€ìƒ‰ ê²°ê³¼ì…ë‹ˆë‹¤.") ) or "ì¼ë³¸ ì—¬í–‰ íšŒí™” ê³µë¶€ë°© ì¼ë°˜ê²Œì‹œíŒì…ë‹ˆë‹¤. ììœ ë¡­ê²Œ ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”." %}
{% set page_robots = "index,follow" %}

{% block content %}

<style>
  .board-table { width:100%; border-collapse:collapse; table-layout:fixed; }
  .board-table th, .board-table td { padding:12px 12px; text-align:left; border-bottom:1px solid rgba(15,23,42,0.06); }
  .board-table th { font-size:12px; color:#64748b; font-weight:900; background:#fafcff; }
  .board-table td { font-size:14px; color:#0f172a; vertical-align:middle; }

  .td-center { text-align:center; }

  .title-wrap { min-width:0; }
  .title-line {
    display:flex;
    align-items:center;
    gap:8px;
    min-width:0;
    font-weight:900;
  }
  .title-link{
    min-width:0;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
    text-decoration:none;
    color:inherit;
  }

  .author-box{ display:flex; align-items:center; gap:8px; min-width:0; }
  .author-name{
    min-width:0;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
    font-weight:800;
  }

  .meta { font-size:13px; color:#334155; font-weight:800; }
  .date { font-size:12px; color:#64748b; font-weight:800; }

  .notice-flag{
    display:inline-flex; align-items:center; gap:6px;
    font-size:12px; font-weight:900;
    color:#b45309;
    background:#fff7ed;
    border:1px solid #fdba74;
    border-radius:999px;
    padding:3px 9px;
    flex:0 0 auto;
  }
</style>

<section class="page-head" style="display:flex; align-items:flex-end; justify-content:space-between; gap:16px;">
  <div>
    <h1>ì¼ë°˜ê²Œì‹œíŒ</h1>

    <form method="GET" action="{{ url_for('board') }}"
          style="display:flex; gap:10px; align-items:center; margin-top:12px;">
      <input
        type="text"
        name="q"
        value="{{ (q or '') | e }}"
        placeholder="ì œëª© ë˜ëŠ” ë‚´ìš© ê²€ìƒ‰"
        style="flex:1; max-width:420px; padding:10px 12px; border-radius:12px; border:1px solid #d9e2ef; background:#fff;">
      <button class="btn btn-primary" type="submit">ê²€ìƒ‰</button>
    </form>

    {% if q %}
      <p style="margin:8px 0 0; color:#667085;">
        ê²€ìƒ‰ì–´: <b>{{ q | e }}</b>
        Â· <a href="{{ url_for('board') }}" style="color:#2563eb; text-decoration:underline; text-underline-offset:3px;">ì „ì²´ ë³´ê¸°</a>
      </p>
    {% else %}
      <p style="margin:8px 0 0; color:#667085;">ììœ ë¡­ê²Œ ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”.</p>
    {% endif %}
  </div>

  <div>
    {% if user %}
      <a class="btn btn-primary" href="{{ url_for('board_write') }}">ê¸€ì“°ê¸°</a>
    {% else %}
      <a class="btn" href="{{ url_for('login', next=url_for('board')) }}">ë¡œê·¸ì¸ í›„ ê¸€ì“°ê¸°</a>
    {% endif %}
  </div>
</section>

<div class="board-wrap" style="padding:0; overflow:hidden;">
  <table class="board-table">
    <colgroup>
      <col style="width:70px;">   {# ë²ˆí˜¸ #}
      <col>                      {# ì œëª©(ê°€ì¥ ë„“ê²Œ) #}
      <col style="width:160px;"> {# ì‘ì„±ì #}
      <col style="width:70px;">  {# ì¶”ì²œ #}
      <col style="width:70px;">  {# ì¡°íšŒ #}
      <col style="width:90px;">  {# ë“±ë¡ì¼ #}
    </colgroup>

    <thead>
      <tr>
        <th class="td-center">ë²ˆí˜¸</th>
        <th>ì œëª©</th>
        <th>ì‘ì„±ì</th>
        <th class="td-center">ì¶”ì²œ</th>
        <th class="td-center">ì¡°íšŒ</th>
        <th class="td-center">ë“±ë¡ì¼</th>
      </tr>
    </thead>

    <tbody>
      {% if posts and posts|length > 0 %}
        {% for p in posts %}
          <tr class="{% if p.is_notice == 1 %}notice-row{% endif %}">
            <td class="td-center meta">
              {% if p.is_notice == 1 %}
                ê³µì§€
              {% else %}
                {{ loop.index }}
              {% endif %}
            </td>

            <td>
              <div class="title-wrap">
                <div class="title-line">
                  {% if p.is_notice == 1 %}
                    <span class="notice-flag">ğŸ“Œ ê³µì§€</span>
                  {% endif %}

                  <a class="title-link" href="{{ url_for('board_detail', post_id=p.id) }}">
                    {{ p.title | e }}
                  </a>
                </div>
              </div>
            </td>

            <td>
              <div class="author-box">
                {% set grade_txt = (p.author_grade or 'ì¼ë°˜')|trim %}
                <span class="pill {% if 'ê´€ë¦¬ì' in grade_txt or 'ğŸ‘‘' in grade_txt %}pill-admin{% endif %}">
                  {{ grade_txt }}
                </span>

                <a href="#"
                  class="author-name mc-open"
                  data-nick="{{ p.author_nickname }}"
                  style="color:#2563eb; text-decoration:underline; text-underline-offset:3px; cursor:pointer;">
                  {{ p.author_nickname | e }}
                </a>

              </div>
            </td>

            <td class="td-center meta">{{ p.upvotes or 0 }}</td>
            <td class="td-center meta">{{ p.views or 0 }}</td>
            <td class="td-center date">{{ p.created_at|mmdd }}</td>
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="6" style="padding:18px 16px; color:#64748b;">
            {% if q %}
              ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
            {% else %}
              ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
            {% endif %}
          </td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>

{% endblock %}
