{% extends "base.html" %}

{# ✅ SEO: 카테고리/서브 타이틀 기반 자동 #}
{% set page_title = (cat_title ~ " · " ~ sub_title ~ " | 상황별 회화 - 일본 여행 회화 공부방") %}
{% set page_desc = "일본어/발음/뜻을 3줄로 빠르게 학습하고, 즐겨찾기로 복습하세요." %}
{% set page_robots = "index,follow" %}

{% block content %}

<section class="page-head">
  <h1>{{ (cat_title or "") | e }} · {{ (sub_title or "") | e }}</h1>
  {% if page_intro %}
  <p class="seo-intro">{{ page_intro }}</p>
  {% endif %}
  <p class="page-guide">
    일본어 / 발음 / 한국어 뜻 3줄로 확인하세요.<br>
    ※ ★ 버튼을 누르면 즐겨찾기에 저장됩니다.
  </p>

  <div class="back-row">
    <a class="back-btn" href="{{ url_for('situations') }}">← 분류 목록</a>
  </div>
</section>

<form method="GET" style="display:flex; gap:10px; margin:12px 0 18px;">
  <input
    type="text"
    name="q"
    value="{{ q or '' }}"
    placeholder="일본어 / 발음 / 한국어로 검색 (예: 今, 이마, 지금)"
    style="flex:1; height:44px; border-radius:14px; border:1px solid rgba(15, 23, 42, 0.10); padding:0 14px; outline:none;"
  >
  <button
    type="submit"
    style="height:44px; padding:0 16px; border-radius:14px; border:none; background:#2563eb; color:#fff; font-weight:800; cursor:pointer;">
    검색
  </button>
</form>

{% if q %}
  <p style="margin:-6px 0 16px; color:#6b7280; font-size:13px; font-weight:700;">
    검색어: <b>{{ q|e }}</b>
    · <a href="{{ url_for('situation_detail', main_key=main_key, sub_key=sub_key) }}"
         style="color:#2563eb; text-decoration:underline; text-underline-offset:3px;">전체 보기</a>
    · 결과: <b>{{ items|length }}</b>개
  </p>
{% endif %}

<section class="phrase-list">
  {% if items and (items|length) > 0 %}
    {% for item in items %}
      <div class="phrase-card"
           data-key="{{ (item.phrase_key or '') | e }}"
           data-jp='{{ (item.jp or "") | tojson }}'
           data-pron='{{ (item.pron or "") | tojson }}'
           data-ko='{{ (item.ko or "") | tojson }}'>

        <button class="fav-btn {% if item.is_fav %}on{% endif %}" type="button" title="즐겨찾기">
          ★
        </button>

        <div class="phrase-body">
          <div class="p-line">
            <span class="p-label">일본어:</span>
            <span class="p-jp">
              {{ (item.jp or "") | e }}
              {% if item.source %}
                <span class="quote-source">({{ (item.source or "") | e }})</span>
              {% endif %}
            </span>
          </div>

          <div class="p-line">
            <span class="p-label">발음:</span>
            <span class="p-pron">{{ (item.pron or "") | e }}</span>
          </div>

          <div class="p-line">
            <span class="p-label">한국어 뜻:</span>
            <span class="p-ko">{{ (item.ko or "") | e }}</span>
          </div>
        </div>

        <button class="speak-btn" type="button" data-tts='{{ (item.jp or "") | tojson }}'>발음 듣기</button>
      </div>
    {% endfor %}
  {% else %}
    <div style="padding:14px 16px; border:1px dashed #d9e2f5; border-radius:14px; color:#64748b; background:#fbfdff;">
      검색 결과가 없습니다.
    </div>
  {% endif %}
</section>

{% endblock %}
